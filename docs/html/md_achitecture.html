<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UTPP: Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UTPP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Motivation</h1>
<p>UnitTest++ is an excellent lightweight test framework but it has a number of irritants like:</p>
<ul>
<li>complete lack of comments</li>
<li>baroque internal structure with tests, test suites, test lists, test results, test details, test reporters, etc.</li>
<li><p class="startli">stylistic issues with 'const madness' like this: </p><div class="fragment"><div class="line">void RunTest(TestResults* const result, Test* const curTest, int const maxTestTimeInMs) const;</div>
</div><!-- fragment --><p class="startli">(an int parameter is always const)</p>
</li>
<li>the GitHub project seems dormant now.</li>
</ul>
<p>This rewrite tried to maintain as much as possible the pubic "API" of the original UnitTest++ but on the inside almost everything has been rewritten.</p>
<h1>Terminology</h1>
<p>The library allows you to define test cases (called <em>tests</em>) and group those cases in <em>test suites</em>. Test suites are executed and the results are displayed using a <em>repoter</em>.</p>
<p>Included are three reporters:</p><ul>
<li><a class="el" href="class_unit_test_1_1_reporter_stdout.html">ReporterStdout</a> generates output to <code>stdout</code>.</li>
<li><a class="el" href="class_unit_test_1_1_reporter_xml.html">ReporterXml</a> generates results in an XML file with a structure similar to the files created by NUnit.</li>
<li><a class="el" href="class_unit_test_1_1_reporter_dbgout.html">ReporterDbgout</a> writes messages to debug output (using OutputDebugString)</li>
</ul>
<p>The function GetDefaultTestReporter() returns an instance of the <code>ReporterStdout</code> object as the default test reporter.</p>
<p>Throughout the execution of a test, one can verify the results and compare them with expected results using <em>CHECK macros</em> (see below).</p>
<h1>Overview</h1>
<p>In its simplest form, a test is defined using the <code>TEST</code> macro similarly with a standard function call: </p><div class="fragment"><div class="line">TEST (MyFirstTest)</div>
<div class="line">{</div>
<div class="line">  // test code goes here</div>
<div class="line">}</div>
</div><!-- fragment --><p>A number of things happen behind the scenes when TEST macro is invoked:</p>
<ol type="1">
<li>It defines a class called <em>TestMyFirstTest</em> derived from <code>Test</code> class. The new class has a method called <code>RunImpl</code> and the block of code following the TEST macro becomes the body of the <em>RunImpl</em> method.</li>
<li><p class="startli">It creates a small factory function (called <code>MyFirstTest_maker</code>) with the following body: </p><div class="fragment"><div class="line">Test* MyFirstTest_maker ()</div>
<div class="line">{</div>
<div class="line">  return new MyFirstTest;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="startli">We are going to call this function the <em>maker function</em>.</p>
</li>
<li><p class="startli">A pointer to the maker together with the name of the current test suite and some additional information is used to create a <code>TestSuite::Inserter</code> object (with the name <code>MyFirstTest_inserter</code>). The current test suite has to be established using a macro like in the following example: </p><div class="fragment"><div class="line">SUITE (LotsOfTests)</div>
<div class="line">{</div>
<div class="line">  // tests definitions go here</div>
<div class="line">}</div>
</div><!-- fragment --><p class="startli">If no suite has been declared, tests are by default appended to the default suite.</p>
</li>
<li>The <code>TestSuite::Inserter</code> constructor appends the newly created object to current test suite.</li>
<li>There is a global <code>SuitesList</code> object that is returned by GetSuitesList() function. This object maintains a container with all currently defined suites.</li>
</ol>
<p>The main program contains a call to <code><a class="el" href="utpp_8h.html#a011d106d4150ae0c8d3fdd63ef8762e5" title="Run all tests from all test suites.">RunAllTests()</a></code> that triggers the following sequence of events:</p>
<ol type="1">
<li>One of the parameters to the <a class="el" href="utpp_8h.html#a011d106d4150ae0c8d3fdd63ef8762e5" title="Run all tests from all test suites.">RunAllTests()</a> function is a TestReporter object, either one explicitly created or a default reporter that sends all results to stdout.</li>
<li>The <a class="el" href="utpp_8h.html#a011d106d4150ae0c8d3fdd63ef8762e5" title="Run all tests from all test suites.">RunAllTests()</a> function calls <code>SuitesList::RunAll()</code> function.</li>
<li><code>SuitesList::RunAll()</code> iterates through the list test suites mentioned before and, for each suite calls the TestSuite::RunTests() function.</li>
<li>TestSuite::RunTests() iterates through the list of tests and for each test does the following:<ul>
<li>Calls maker function to instantiate a new Test-derived object (like TestMyFirstTest).</li>
<li>Calls the Test::Run method which in turn calls the TestMyFirstTest::RunImpl. This is actually the test code that was placed after the TEST macro.</li>
<li>When the test has finished, the Test-derived object is deleted.</li>
</ul>
</li>
</ol>
<p>Throughout this process, different methods of the reporter are called at appropriate moments (beginning of test suite, beginning of test, end of test, end of suite, end of run).</p>
<h1>Checking Test Results</h1>
<p>There are a a number of macro-definitions for testing abnormal conditions while running a test:</p>
<p><code><a class="el" href="checks_8h.html#a76bb1ed1c7c2e0e58db57d181d5afbf8" title="Generate a failure if value is 0. Failure message is the value itself.">CHECK(value)</a></code> Verifies that value is true (or not 0).</p>
<p><code><a class="el" href="checks_8h.html#ad8fa79f5d491cc01af302832785e90fe" title="Generate a failure if actual value is different from expected.">CHECK_EQUAL(expected, actual)</a></code> Compares two values for equality.</p>
<p><code><a class="el" href="checks_8h.html#a4e1bd8b7b16e3e16c07270b99cc4de75">CHECK_CLOSE(expected, actual, tolerance)</a></code> Checks that two values are closer than specified tolerance.</p>
<p><code><a class="el" href="checks_8h.html#ab805d258626678b2e84a42f51436ecd0" title="Generate a failure if an array is different from expected results.">CHECK_ARRAY_EQUAL(expected, actual, count)</a></code> Compares two arrays for equality.</p>
<p><code><a class="el" href="checks_8h.html#ae6d7b175b274884e9c9fa474c697774f">CHECK_ARRAY_CLOSE(expected, actual, count, tolerance)</a></code> Checks that two arrays are closer than specified tolerance.</p>
<p><code><a class="el" href="checks_8h.html#aa221a99c264579731650cb05888f4819">CHECK_ARRAY2D_CLOSE(expected, actual, rows, columns, tolerance)</a></code> Checks that two matrices are within the specified tolerance.</p>
<p><code><a class="el" href="checks_8h.html#ae05a9b5e541382015919759ad8215e0e" title="Checks if evaluating the expression triggers an exception of the given type.">CHECK_THROW(ExceptionType, expression)</a></code> Verifies that expression throws an of the given type.</p>
<p><code><a class="el" href="checks_8h.html#a44dc1d10280d595c3f734edb19308715">CHECK_THROW_EQUAL(ExceptionType, expected, expression)</a></code> Verifies that expression throws an of the given type and with the expected value.</p>
<p>CHECK_EQUAL and CHECK_THOW_EQUAL macros use a template function <a class="el" href="checks_8h.html#ab5d6cfe163ed7fcf09195267e207cba6">UnitTest::CheckEqual()</a> to compare their arguments. That means they can be used to compare any objects that define a suitable equality operator.</p>
<h1>Using Test Suites</h1>
<p>Tests can be grouped together in <em>suites</em> like in the following example: </p><div class="fragment"><div class="line">SUITE (BigSuite)</div>
<div class="line">{</div>
<div class="line">  TEST (MyFirstTest)</div>
<div class="line">  {</div>
<div class="line">    // test code goes here</div>
<div class="line">  }</div>
<div class="line">  TEST (MySecondTest)</div>
<div class="line">  {</div>
<div class="line">    //another test case</div>
<div class="line">  }</div>
<div class="line">  // ....</div>
<div class="line">}</div>
</div><!-- fragment --><p>The SUITE macro defines in effect a namespace (called <em>SuiteBigSuite</em>) and makes all tests, objects inside the namespace.</p>
<p>It also defines a function <a class="el" href="utpp_8h.html#aa95b53f561107edd47ca261db1b88da8">GetSuiteName()</a> inside this namespace that returns the name of the current suite. This function is called by the TEST macros to obtain the suite name.</p>
<h1>Fixtures</h1>
<p>In many (most) cases one needs a certain environment for executing the test and the same environment might be reused in multiple tests. This environment is represented by a 'fixture' class. The constructor of the fixture is responsible for bringing up the environment. Here is an example of some tests with a fixture: </p><div class="fragment"><div class="line">struct Account_fixture {</div>
<div class="line">  Account_fixture () : amount_usd(100), amount_eur(0), amount_chf(0) {};</div>
<div class="line"> </div>
<div class="line">  int amount _usd;</div>
<div class="line">  int amount_eur;</div>
<div class="line">  int amount_chf;</div>
<div class="line">}</div>
<div class="line">TEST_FIXTURE (Account_fixture, TestExchangeEur)</div>
<div class="line">{</div>
<div class="line">  ExchangeToEur(&amp;amount_usd, &amp;amount_eur);</div>
<div class="line">  CHECK_EQUAL (0, amount_usd);</div>
<div class="line">  CHECK (amout_eur &gt; 0);</div>
<div class="line">}</div>
<div class="line">TEST_FIXTURE (Account_fixture, TestExchangeChf)</div>
<div class="line">{</div>
<div class="line">  ExchangeToChf(&amp;amount_usd, &amp;amount_chf);</div>
<div class="line">  CHECK_EQUAL (0, amount_usd);</div>
<div class="line">  CHECK (amount_chf &gt; 0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>At the beginning of each test, the amounts are initialized by the <code>Account_fixture</code> constructor. Because each test object inherits from the fixture, all members (or methods) of the fixture can be freely accessed during the test.</p>
<p>TEST_FIXTURE macro simply defines an object that inherits from both the fixture and the Test object. Otherwise tests with fixtures are treated same as tests without fixture. When the test is run the maker function invokes the object constructor which in turn invokes the fixture constructor (and the Test constructor).</p>
<h1>Global Objects</h1>
<p>There are two global object pointers: <code>CurrentTest</code> and <code>CurrentReporter</code>. They need to be global to allow calls to check macros from anywhere. The TestSuite::RunTests function also initializes the <code>CurrentReporter</code> pointer.</p>
<p>In addition, the global string object <code>CurrentSuite</code> contains the name of the currently running suite.</p>
<p>Unfortunately, prior to C++17, global objects cannot be easily used in C++ header-only libraries. To solve this problem, UTPP replaces the <code>main</code> with a macro <code>TEST_MAIN</code> that can be used just like the usual main function. Behind the scenes, <code>TEST_MAIN</code> defines all the required global objects and generates the <code>main</code> function.</p>
<p>If you are using C++17 or higher, you can use the usual <code>main</code> function. In this case <code>TEST_MAIN</code> is defined only for compatibility with previous C++ versions. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
